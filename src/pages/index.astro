---
/**
 * Homepage - Integrates all React components with Astro
 * Following originrealms.com design pattern
 */
import { getCollection } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import PageLoader from '../components/PageLoader.astro';

// React components
import Header from '../components/react/Header';
import HeroSection from '../components/react/HeroSection';
import NewsSection from '../components/react/NewsSection';
import AboutSection from '../components/react/AboutSection';
import SocialSection from '../components/react/SocialSection';
import Footer from '../components/react/Footer';

// Constants
import {
  SITE_TITLE,
  SITE_DESCRIPTION,
  NAV_LINKS,
  SOCIAL_LINKS,
  FOOTER_CONFIG,
} from '../consts';

// Assets - import images through Astro for proper handling
import heroImage from '../assets/images/hero/hero.webp';
import decorationImage from '../assets/images/decorations/orbit-discord.webp';

// Piston animation images
import pistonBase from '../assets/animations/piston-base.png';
import pistonHead from '../assets/animations/piston-head.png';
import pistonNeck from '../assets/animations/piston-neck.png';

// Get the src URLs from imported images
const heroImageSrc = heroImage.src;
const decorationImageSrc = decorationImage.src;

// Piston images for Footer
const pistonImages = {
  base: pistonBase.src,
  head: pistonHead.src,
  neck: pistonNeck.src,
};

// Fetch latest blog posts (limit to 3)
const allPosts = await getCollection('blog');
const latestPosts = allPosts
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3)
  .map((post) => ({
    slug: post.id,
    title: post.data.title,
    description: post.data.description,
    pubDate: post.data.pubDate,
    // heroImage needs to be a URL string for React component
    heroImage: post.data.heroImage?.src,
    // category from blog schema
    category: post.data.category,
    categoryColor: post.data.categoryColor,
  }));

// Fetch tech stack items for About section
const allTech = await getCollection('tech');
const techMembers = allTech
  .sort((a, b) => (a.data.order ?? 0) - (b.data.order ?? 0))
  .map((tech) => ({
    name: tech.data.name,
    role: tech.data.role,
    color: tech.data.roleColor,
    description: tech.data.description,
    icon: tech.data.icon.src,
    portrait: tech.data.portrait.src,
  }));
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </head>
  <body class="bg-black text-gray-500">
    <!-- Page loader - shows during initial load and navigation -->
    <PageLoader />

    <!-- Main page content wrapper (no container constraint for full-width elements) -->
    <main class="pageContent">
      <!-- Header - inside container for proper alignment -->
      <div class="container mx-auto">
        <Header
          client:load
          siteTitle={SITE_TITLE}
          navLinks={NAV_LINKS}
          socialLinks={SOCIAL_LINKS}
          currentPath="/"
        />
      </div>

      <!-- Hero section - OUTSIDE container for full-width display like Origin Realms -->
      <HeroSection
        client:visible
        imageSrc={heroImageSrc}
        imageAlt="Hero background"
      />

      <!-- Rest of content inside container -->
      <div class="container mx-auto">
        <!-- News/Blog section - hydrate when visible -->
        <NewsSection
          client:visible
          posts={latestPosts}
          viewAllLink="/blog"
        />

        <!-- About section with progress bar - hydrate when visible -->
        <AboutSection
          client:visible
          title="About Me"
          subtitle="Learn about the technologies I work with!"
          members={techMembers}
          cycleDuration={8000}
        />

        <!-- Social section - hydrate when visible -->
        <SocialSection
          client:visible
          title="Join the Community"
          description="Connect with me on social media and join the conversation!"
          links={SOCIAL_LINKS}
          decorationImage={decorationImageSrc}
        />

        <!-- Footer - hydrate when visible for social link interactions -->
        <Footer
          client:visible
          email={FOOTER_CONFIG.email}
          socialLinks={SOCIAL_LINKS}
          copyright={FOOTER_CONFIG.copyright}
          pistonImages={pistonImages}
        />
      </div>
    </main>
  </body>
</html>
