---
/**
 * Resume page
 * URL: /resume
 * Features: Hero banner + Document carousel with 3-card layout
 */
import { getCollection } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import PageLoader from '../components/PageLoader.astro';

// React components
import Header from '../components/react/Header';
import Footer from '../components/react/Footer';
import ResumeBanner from '../components/react/ResumeBanner';
import InfoButton from '../components/react/InfoButton';
import ResumeCarousel from '../components/react/ResumeCarousel';

// Constants
import {
  SITE_TITLE,
  SITE_DESCRIPTION,
  NAV_LINKS,
  SOCIAL_LINKS,
  FOOTER_CONFIG,
} from '../consts';

// Piston animation images for Footer
import pistonBase from '../assets/animations/piston-base.png';
import pistonHead from '../assets/animations/piston-head.png';
import pistonNeck from '../assets/animations/piston-neck.png';

const pistonImages = {
  base: pistonBase.src,
  head: pistonHead.src,
  neck: pistonNeck.src,
};

// Fetch document collection and transform to DocumentCardData format
const documents = await getCollection('document');

// Sort by pubDate (newest first) and transform to card data
const documentItems = documents
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())
  .map((doc) => ({
    id: doc.id,
    title: doc.data.title,
    subtitle: doc.data.subTitle,
    category: doc.data.category,
    categoryColor: doc.data.categoryColor,
    image: doc.data.icon?.src || '',
    link: doc.data.links?.[0]?.url || '',
  }));
---

<!doctype html>
<html lang="en" class="h-full">
  <head>
    <BaseHead
      title={`Resume | ${SITE_TITLE}`}
      description={SITE_DESCRIPTION}
    />
  </head>
  <body class="h-full bg-black text-gray-500">
    <PageLoader />

    <!-- Grid layout for sticky footer: auto (header) + 1fr (main) + auto (footer) -->
    <div class="h-screen grid grid-rows-[auto_1fr_auto]">
      <!-- Header -->
      <div class="container mx-auto">
        <Header
          client:load
          siteTitle={SITE_TITLE}
          navLinks={NAV_LINKS}
          socialLinks={SOCIAL_LINKS}
          currentPath="/resume"
        />
      </div>

      <!-- Resume content -->
      <main class="pageContent">
        <div class="container mx-auto pt-8">
          <!-- Hero Banner -->
          <ResumeBanner client:load />

          <!-- Info Button -->
          <InfoButton client:load />

          <!-- Document Carousel -->
          <div>
            <ResumeCarousel client:load items={documentItems} />
          </div>
        </div>
      </main>

      <!-- Footer -->
      <div class="container mx-auto">
        <Footer
          client:visible
          email={FOOTER_CONFIG.email}
          socialLinks={SOCIAL_LINKS}
          copyright={FOOTER_CONFIG.copyright}
          pistonImages={pistonImages}
        />
      </div>
    </div>
  </body>
</html>
