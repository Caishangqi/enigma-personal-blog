---
/**
 * Project listing page with pagination
 * URL: /project/1, /project/2, etc.
 * Uses Astro's getStaticPaths with paginate() for static generation
 */
import type { GetStaticPaths } from 'astro';
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import PageLoader from '../../components/PageLoader.astro';

// React components
import Header from '../../components/react/Header';
import Footer from '../../components/react/Footer';
import Pagination from '../../components/react/Pagination';
import ProjectCard from '../../components/react/ProjectCard';

// Constants
import {
  SITE_TITLE,
  SITE_DESCRIPTION,
  NAV_LINKS,
  SOCIAL_LINKS,
  FOOTER_CONFIG,
} from '../../consts';

// Piston animation images for Footer
import pistonBase from '../../assets/animations/piston-base.png';
import pistonHead from '../../assets/animations/piston-head.png';
import pistonNeck from '../../assets/animations/piston-neck.png';

const pistonImages = {
  base: pistonBase.src,
  head: pistonHead.src,
  neck: pistonNeck.src,
};

export const getStaticPaths = (async ({ paginate }) => {
  // Get all projects sorted by date (newest first)
  const projects = (await getCollection('project')).sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
  );

  // Generate paginated pages (6 projects per page)
  return paginate(projects, { pageSize: 6 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;

// Transform projects for display
const projectList = page.data.map((project) => ({
  slug: project.id,
  title: project.data.title,
  description: project.data.description,
  updatedDate: project.data.updatedDate,
  category: project.data.category,
  categoryColor: project.data.categoryColor,
  heroImage: project.data.heroImage?.src,
  iconImage: project.data.iconImage?.src,
  tags: project.data.tags,
}));
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead
      title={page.currentPage === 1 ? `Project | ${SITE_TITLE}` : `Project - Page ${page.currentPage} | ${SITE_TITLE}`}
      description={SITE_DESCRIPTION}
    />
  </head>
  <body class="bg-black text-gray-500">
    <PageLoader />

    <main class="pageContent">
      <!-- Header -->
      <div class="container mx-auto">
        <Header
          client:load
          siteTitle={SITE_TITLE}
          navLinks={NAV_LINKS}
          socialLinks={SOCIAL_LINKS}
          currentPath="/project"
        />
      </div>

      <!-- Project content -->
      <div class="container mx-auto pt-12">
        <!-- Project list -->
        <div class="project-list">
          {
            projectList.map((project) => (
              <ProjectCard
                slug={project.slug}
                title={project.title}
                description={project.description}
                updatedDate={project.updatedDate}
                category={project.category}
                categoryColor={project.categoryColor}
                heroImage={project.heroImage}
                iconImage={project.iconImage}
                tags={project.tags}
              />
            ))
          }
        </div>

        {page.data.length === 0 && (
          <div class="text-center py-12">
            <p class="text-gray-400 text-lg">No projects yet. Check back soon!</p>
          </div>
        )}

        <!-- Pagination -->
        <Pagination
          client:visible
          currentPage={page.currentPage}
          totalPages={page.lastPage}
          baseUrl="/project"
        />
      </div>

      <!-- Footer -->
      <div class="container mx-auto">
        <Footer
          client:visible
          email={FOOTER_CONFIG.email}
          socialLinks={SOCIAL_LINKS}
          copyright={FOOTER_CONFIG.copyright}
          pistonImages={pistonImages}
        />
      </div>
    </main>
  </body>
</html>
